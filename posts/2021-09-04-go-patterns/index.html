<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>All sizes of go patterns | Random notes to myself</title>
<meta name=keywords content>
<meta name=description content="Concurrency is the composition of independently executing computations.
Goroutines are not threads, but it is not wrong to think about goroutines as threads. In fact in runtime goroutines are multiplexed onto threads that are created as needed in order to make sure no goroutine ever blocks.
Patterns. Generator.
package main import ( &#34;fmt&#34; &#34;strconv&#34; ) func main() { out := generate() for i := 0; i < 5; i++ { fmt.">
<meta name=author content>
<link rel=canonical href=https://slash3b.github.io/posts/2021-09-04-go-patterns/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.6f60056d44d3f7eb69a4bc6c332b59960f3a995802bded244750232f33713c49.css integrity="sha256-b2AFbUTT9+tppLxsMytZlg86mVgCve0kR1AjLzNxPEk=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://slash3b.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://slash3b.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://slash3b.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://slash3b.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://slash3b.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.89.4">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript><meta property="og:title" content="All sizes of go patterns">
<meta property="og:description" content="Concurrency is the composition of independently executing computations.
Goroutines are not threads, but it is not wrong to think about goroutines as threads. In fact in runtime goroutines are multiplexed onto threads that are created as needed in order to make sure no goroutine ever blocks.
Patterns. Generator.
package main import ( &#34;fmt&#34; &#34;strconv&#34; ) func main() { out := generate() for i := 0; i < 5; i++ { fmt.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://slash3b.github.io/posts/2021-09-04-go-patterns/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-09-04T00:00:00+00:00">
<meta property="article:modified_time" content="2021-09-04T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="All sizes of go patterns">
<meta name=twitter:description content="Concurrency is the composition of independently executing computations.
Goroutines are not threads, but it is not wrong to think about goroutines as threads. In fact in runtime goroutines are multiplexed onto threads that are created as needed in order to make sure no goroutine ever blocks.
Patterns. Generator.
package main import ( &#34;fmt&#34; &#34;strconv&#34; ) func main() { out := generate() for i := 0; i < 5; i++ { fmt.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://slash3b.github.io/posts/"},{"@type":"ListItem","position":3,"name":"All sizes of go patterns","item":"https://slash3b.github.io/posts/2021-09-04-go-patterns/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"All sizes of go patterns","name":"All sizes of go patterns","description":"Concurrency is the composition of independently executing computations.\nGoroutines are not threads, but it is not wrong to think about goroutines as threads. In fact in runtime goroutines are multiplexed onto threads that are created as needed in order to make sure no goroutine ever blocks.\nPatterns. Generator.\npackage main import ( \u0026quot;fmt\u0026quot; \u0026quot;strconv\u0026quot; ) func main() { out := generate() for i := 0; i \u0026lt; 5; i++ { fmt.","keywords":[],"articleBody":"Concurrency is the composition of independently executing computations.\nGoroutines are not threads, but it is not wrong to think about goroutines as threads. In fact in runtime goroutines are multiplexed onto threads that are created as needed in order to make sure no goroutine ever blocks.\nPatterns. Generator.\npackage main import ( \"fmt\" \"strconv\" ) func main() { out := generate() for i := 0; i Fan-in function or Multiplexer.\npackage main import ( \"fmt\" ) func sayHey() NOTE.\nIn these examples individual components we use are a sequential code and we are composing their independent execution.\nWorker pool\ntodo Rate limiter simple rate limiter using a buffered channel wrap handler with a func that tries to add to channel and defers release. If lenght of buffered channel is 10 then when we have 10 ongoing requests will be pending\n\trateLimiterMiddleware := func(f func(http.ResponseWriter, *http.Request)) func(http.ResponseWriter, *http.Request) { limitingBuffer := make(chan struct{}, 10) return func(w http.ResponseWriter, r *http.Request) { limitingBuffer Sources:\n https://www.youtube.com/watch?v=f6kdp27TYZs  ","wordCount":"306","inLanguage":"en","datePublished":"2021-09-04T00:00:00Z","dateModified":"2021-09-04T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://slash3b.github.io/posts/2021-09-04-go-patterns/"},"publisher":{"@type":"Organization","name":"Random notes to myself","logo":{"@type":"ImageObject","url":"https://slash3b.github.io/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://slash3b.github.io accesskey=h title="Random notes to myself (Alt + H)">Random notes to myself</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
All sizes of go patterns
</h1>
<div class=post-meta>September 4, 2021
</div>
</header>
<div class=post-content><p>Concurrency is the composition of independently executing computations.</p>
<p>Goroutines are not threads, but it is not wrong to think about goroutines as threads.
In fact in runtime goroutines are multiplexed onto threads that are created as needed in order to make sure
no goroutine ever blocks.</p>
<h3 id=patterns>Patterns.<a hidden class=anchor aria-hidden=true href=#patterns>#</a></h3>
<p>Generator.</p>
<pre tabindex=0><code>package main

import (
	&quot;fmt&quot;
	&quot;strconv&quot;
)

func main() {
	out := generate()

	for i := 0; i &lt; 5; i++ {
		fmt.Printf(&quot;Generated %s \n&quot;, &lt;-out)
	}

	fmt.Println(&quot;Done!&quot;)
}

func generate() &lt;-chan string {
	a := make(chan string)

	go func() {
		i := 0
		for {
			a &lt;- strconv.Itoa(i)
			i++
		}
	}()

	return a
}

</code></pre><p>Fan-in function or Multiplexer.</p>
<pre tabindex=0><code>package main

import (
	&quot;fmt&quot;
)

func sayHey() &lt;-chan string {
	heyCh := make(chan string)

	go func() {
		for {
			// imagine it takes some random time to output &quot;hey&quot;
			heyCh &lt;- &quot;hey&quot;
		}
	}()

	return heyCh
}

func fanIn(a, b &lt;-chan string) &lt;-chan string {
	fanInChannel := make(chan string)

	go func() {

		for {
			select {
			case ans := &lt;-a:
				fanInChannel &lt;- ans
			case ans := &lt;-b:
				fanInChannel &lt;- ans
			}
		}
	}()

	return fanInChannel
}

func main() {

	a := sayHey()
	b := sayHey()

	fan := fanIn(a, b)

	for i := 0; i &lt; 6; i++ {
		fmt.Println(i, &lt;-fan)
	}

	fmt.Println(&quot;done!&quot;)
}
</code></pre><p>NOTE.</p>
<p>In these examples individual components we use are a sequential code and we are composing
their independent execution.</p>
<p>Worker pool</p>
<pre tabindex=0><code>todo
</code></pre><p>Rate limiter
simple rate limiter using a buffered channel
wrap handler with a func that tries to add to channel
and defers release. If lenght of buffered channel is 10
then when we have 10 ongoing requests will be pending</p>
<pre tabindex=0><code>	rateLimiterMiddleware := func(f func(http.ResponseWriter, *http.Request)) func(http.ResponseWriter, *http.Request) {

		limitingBuffer := make(chan struct{}, 10)
		return func(w http.ResponseWriter, r *http.Request) {

			limitingBuffer &lt;- struct{}{}
			defer func() { &lt;-limitingBuffer }()

			f(w, r)
		}
	}
</code></pre><p>Sources:</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=f6kdp27TYZs">https://www.youtube.com/watch?v=f6kdp27TYZs</a></li>
</ul>
</div>
<footer class=post-footer>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://slash3b.github.io>Random notes to myself</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>